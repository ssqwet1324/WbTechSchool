<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processor - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            background: #fafafa;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-danger:hover:not(:disabled) {
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow: 0 10px 20px rgba(81, 207, 102, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input.error {
            border-color: #ff6b6b;
        }

        .photo-id-display {
            background: #e8f2ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        .processing-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .processing-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .processing-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .size-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .size-inputs input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
        }

        .size-inputs input.error {
            border-color: #ff6b6b;
        }

        .result-area {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .result-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 10px 0;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .api-info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .api-info h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .api-info code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .error-text {
            font-size: 0.9rem;
            color: #ff6b6b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Image Processor</h1>
            <p>–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏</p>
        </div>

        <div class="content">
            <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
            <div class="section">
                <h2>üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h3>
                    <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF</p>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                </div>
                <div id="uploadStatus"></div>
                <div id="photoIdDisplay" class="photo-id-display hidden"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ -->
            <div class="section">
                <h2>üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
                <div id="processingSection" class="hidden">
                    <div class="processing-buttons">
                        <!-- Resize -->
                        <div class="processing-section">
                            <h3>üìè –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä</h3>
                            <div class="size-inputs">
                                <input type="number" id="resizeWidth" placeholder="–®–∏—Ä–∏–Ω–∞" min="1" max="4000">
                                <input type="number" id="resizeHeight" placeholder="–í—ã—Å–æ—Ç–∞" min="1" max="4000">
                            </div>
                            <div class="help-text">–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –±–æ–ª—å—à–µ 0 –ø–∏–∫—Å–µ–ª–µ–π</div>
                            <div id="resizeError" class="error-text hidden"></div>
                            <button class="btn" onclick="processImage('resize')" id="resizeBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å Resize</button>
                        </div>

                        <!-- Miniature -->
                        <div class="processing-section">
                            <h3>üñºÔ∏è –ú–∏–Ω–∏–∞—Ç—é—Ä–∞</h3>
                            <div class="size-inputs">
                                <input type="number" id="miniatureWidth" placeholder="–®–∏—Ä–∏–Ω–∞" min="1" max="500">
                                <input type="number" id="miniatureHeight" placeholder="–í—ã—Å–æ—Ç–∞" min="1" max="500">
                            </div>
                            <div class="help-text">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 500x500 –ø–∏–∫—Å–µ–ª–µ–π</div>
                            <div id="miniatureError" class="error-text hidden"></div>
                            <button class="btn" onclick="processImage('miniature')" id="miniatureBtn">–°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É</button>
                        </div>

                        <!-- Watermark -->
                        <div class="processing-section">
                            <h3>üè∑Ô∏è –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</h3>
                            <p style="text-align: center; color: #666; margin-bottom: 15px;">
                                –î–æ–±–∞–≤–∏—Ç —Ç–µ–∫—Å—Ç "Watermark" —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é 50%
                            </p>
                            <div class="help-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏</div>
                            <button class="btn" onclick="processImage('watermark')" id="watermarkBtn">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</button>
                        </div>
                    </div>
                </div>
                <div id="processingStatus"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
            <div class="section">
                <h2>üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h2>
                <div class="form-group">
                    <label for="getPhotoId">ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</label>
                    <input type="text" id="getPhotoId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ">
                    <div class="help-text">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ</div>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="getProcessedImage('resize')" id="getResizeBtn">–ü–æ–ª—É—á–∏—Ç—å Resize</button>
                    <button class="btn btn-success" onclick="getProcessedImage('miniature')" id="getMiniatureBtn">–ü–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É</button>
                    <button class="btn btn-success" onclick="getProcessedImage('watermark')" id="getWatermarkBtn">–ü–æ–ª—É—á–∏—Ç—å —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º</button>
                </div>
                <div id="getStatus"></div>
                <div id="resultArea" class="result-area hidden">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                    <img id="resultImage" class="result-image" alt="–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ -->
            <div class="section">
                <h2>üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
                <div class="form-group">
                    <label for="deletePhotoId">ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:</label>
                    <input type="text" id="deletePhotoId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ">
                    <div class="help-text">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ</div>
                </div>
                <button class="btn btn-danger" onclick="deletePhoto()" id="deleteBtn">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
                <div id="deleteStatus"></div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API -->
            <div class="api-info">
                <h4>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API</h4>
                <p><strong>–ë–∞–∑–æ–≤—ã–π URL:</strong> <code>http://localhost:8081</code></p>
                <p><strong>Endpoints:</strong></p>
                <ul>
                    <li><code>POST /upload</code> - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ</li>
                    <li><code>POST /process</code> - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ</li>
                    <li><code>GET /image/:id/:photo_version</code> - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ</li>
                    <li><code>DELETE /image/delete</code> - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ</li>
                </ul>
                <p><strong>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong></p>
                <ul>
                    <li>‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º</li>
                    <li>‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è resize –∏ miniature</li>
                    <li>‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8081';
        let currentPhotoId = null;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag & drop
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                uploadFile(file);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('image', file);

            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
            console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª:', {
                name: file.name,
                size: file.size,
                type: file.type,
                lastModified: file.lastModified
            });

            showStatus('uploadStatus', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...', 'info');
            setButtonState('upload', true);

            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    currentPhotoId = result.photo_id;
                    console.log('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ, Photo ID:', currentPhotoId);
                    showStatus('uploadStatus', `–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! ID: ${currentPhotoId}`, 'success');
                    showPhotoId(currentPhotoId);
                    showProcessingSection();
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', result.error);
                    showStatus('uploadStatus', `–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showStatus('uploadStatus', `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            } finally {
                setButtonState('upload', false);
            }
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
        function validateSizeInputs(width, height, type) {
            const widthInput = document.getElementById(`${type}Width`);
            const heightInput = document.getElementById(`${type}Height`);
            const errorDiv = document.getElementById(`${type}Error`);
            
            // –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –æ—à–∏–±–æ–∫
            widthInput.classList.remove('error');
            heightInput.classList.remove('error');
            errorDiv.classList.add('hidden');

            if (!width || !height) {
                widthInput.classList.add('error');
                heightInput.classList.add('error');
                errorDiv.textContent = '–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É!';
                errorDiv.classList.remove('hidden');
                return false;
            }

            if (width <= 0 || height <= 0) {
                widthInput.classList.add('error');
                heightInput.classList.add('error');
                errorDiv.textContent = '–†–∞–∑–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–æ–ª—å—à–µ 0!';
                errorDiv.classList.remove('hidden');
                return false;
            }

            if (type === 'miniature' && (width > 500 || height > 500)) {
                widthInput.classList.add('error');
                heightInput.classList.add('error');
                errorDiv.textContent = '–†–∞–∑–º–µ—Ä –º–∏–Ω–∏–∞—Ç—é—Ä—ã –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 500 –ø–∏–∫—Å–µ–ª–µ–π!';
                errorDiv.classList.remove('hidden');
                return false;
            }

            return true;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        async function processImage(version) {
            if (!currentPhotoId) {
                showStatus('processingStatus', '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ!', 'error');
                return;
            }

            const data = {
                photo_id: currentPhotoId,
                version: version
            };

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è resize –∏ miniature
            if (version === 'resize') {
                const width = parseInt(document.getElementById('resizeWidth').value);
                const height = parseInt(document.getElementById('resizeHeight').value);
                if (!validateSizeInputs(width, height, 'resize')) {
                    return;
                }
                data.width = width.toString();
                data.height = height.toString();
            } else if (version === 'miniature') {
                const width = parseInt(document.getElementById('miniatureWidth').value);
                const height = parseInt(document.getElementById('miniatureHeight').value);
                if (!validateSizeInputs(width, height, 'miniature')) {
                    return;
                }
                data.width = width.toString();
                data.height = height.toString();
            }

            showStatus('processingStatus', `–û–±—Ä–∞–±–æ—Ç–∫–∞ ${version}...`, 'info');
            setButtonState(version, true);

            try {
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', data);
                console.log('Version:', version);
                
                // –î–ª—è resize –∏ miniature –¥–æ–±–∞–≤–ª—è–µ–º query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                let url = `${API_BASE_URL}/process`;
                if (version === 'resize' || version === 'miniature') {
                    url += `?widthPhoto=${data.width}&heightPhoto=${data.height}`;
                    console.log('URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:', url);
                }
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–∞:', result);
                    showStatus('processingStatus', `–û–±—Ä–∞–±–æ—Ç–∫–∞ ${version} –∑–∞–ø—É—â–µ–Ω–∞! ID: ${result.start_processing}`, 'success');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', result.error);
                    showStatus('processingStatus', `–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('processingStatus', `–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${error.message}`, 'error');
            } finally {
                setButtonState(version, false);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        async function getProcessedImage(version) {
            const photoId = document.getElementById('getPhotoId').value || currentPhotoId;
            
            if (!photoId) {
                showStatus('getStatus', '–í–≤–µ–¥–∏—Ç–µ ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏!', 'error');
                return;
            }

            showStatus('getStatus', `–ü–æ–ª—É—á–µ–Ω–∏–µ ${version}...`, 'info');
            setButtonState(`get${version.charAt(0).toUpperCase() + version.slice(1)}`, true);

            try {
                const response = await fetch(`${API_BASE_URL}/image/${photoId}/${version}`);
                const result = await response.json();

                if (response.ok) {
                    showStatus('getStatus', `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${version} –ø–æ–ª—É—á–µ–Ω–æ!`, 'success');
                    showResultImage(result.img_url);
                } else {
                    showStatus('getStatus', `–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('getStatus', `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è: ${error.message}`, 'error');
            } finally {
                setButtonState(`get${version.charAt(0).toUpperCase() + version.slice(1)}`, false);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        async function deletePhoto() {
            const photoId = document.getElementById('deletePhotoId').value || currentPhotoId;
            
            if (!photoId) {
                showStatus('deleteStatus', '–í–≤–µ–¥–∏—Ç–µ ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏!', 'error');
                return;
            }

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ —Å ID: ${photoId}?`)) {
                return;
            }

            showStatus('deleteStatus', '–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ...', 'info');
            setButtonState('delete', true);

            try {
                const deleteData = {
                    photo_id: photoId,
                    version: "",
                    width: "",
                    height: "",
                    bucket_name: ""
                };
                
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:', deleteData);
                
                const response = await fetch(`${API_BASE_URL}/image/delete`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(deleteData)
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus('deleteStatus', `–§–æ—Ç–æ ${result.deleted_photo} —É–¥–∞–ª–µ–Ω–æ!`, 'success');
                    if (photoId === currentPhotoId) {
                        currentPhotoId = null;
                        hidePhotoId();
                        hideProcessingSection();
                    }
                } else {
                    showStatus('deleteStatus', `–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('deleteStatus', `–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            } finally {
                setButtonState('delete', false);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showPhotoId(photoId) {
            const element = document.getElementById('photoIdDisplay');
            element.textContent = `ID –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ: ${photoId}`;
            element.classList.remove('hidden');
        }

        function hidePhotoId() {
            document.getElementById('photoIdDisplay').classList.add('hidden');
        }

        function showProcessingSection() {
            document.getElementById('processingSection').classList.remove('hidden');
        }

        function hideProcessingSection() {
            document.getElementById('processingSection').classList.add('hidden');
        }

        function showResultImage(url) {
            const resultArea = document.getElementById('resultArea');
            const resultImage = document.getElementById('resultImage');
            
            resultImage.src = url;
            resultArea.classList.remove('hidden');
        }

        function setButtonState(buttonType, loading) {
            const buttonMap = {
                'upload': null,
                'resize': 'resizeBtn',
                'miniature': 'miniatureBtn',
                'watermark': 'watermarkBtn',
                'getResize': 'getResizeBtn',
                'getMiniature': 'getMiniatureBtn',
                'getWatermark': 'getWatermarkBtn',
                'delete': 'deleteBtn'
            };

            const buttonId = buttonMap[buttonType];
            if (buttonId) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.disabled = loading;
                    if (loading) {
                        button.innerHTML = `<span class="loading"></span>–û–±—Ä–∞–±–æ—Ç–∫–∞...`;
                    } else {
                        button.innerHTML = button.textContent.replace(/–û–±—Ä–∞–±–æ—Ç–∫–∞\.\.\./, '').trim();
                    }
                }
            }
        }
    </script>
</body>
</html>
